## Before anything , a dedicated Oracle database schema named thu_28982_huguette_loyalty_db was created to host all project objects including tables, procedures, triggers, and packages.

1ï¸âƒ£ SEQUENCES
CREATE SEQUENCE seq_customer_id START WITH 10001 INCREMENT BY 1;
CREATE SEQUENCE seq_purchase_id START WITH 20001 INCREMENT BY 1;
CREATE SEQUENCE seq_reward_id   START WITH 30001 INCREMENT BY 1;
CREATE SEQUENCE seq_rule_id     START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_log_id      START WITH 60001 INCREMENT BY 1;

2ï¸âƒ£ TABLE CREATION
ðŸ”¹ CUSTOMERS
CREATE TABLE customers (
    customer_id        NUMBER(10) PRIMARY KEY,
    first_name         VARCHAR2(50) NOT NULL,
    last_name          VARCHAR2(50) NOT NULL,
    email              VARCHAR2(100) UNIQUE NOT NULL,
    phone_number       VARCHAR2(15) NOT NULL,
    date_of_birth      DATE,
    registration_date  DATE DEFAULT SYSDATE,
    membership_tier    VARCHAR2(20) DEFAULT 'BRONZE'
        CHECK (membership_tier IN ('BRONZE','SILVER','GOLD','PLATINUM'))
);

ðŸ”¹ PURCHASES
CREATE TABLE purchases (
    purchase_id     NUMBER(10) PRIMARY KEY,
    customer_id     NUMBER(10) NOT NULL,
    purchase_date   TIMESTAMP DEFAULT SYSTIMESTAMP,
    total_amount    NUMBER(10,2) CHECK (total_amount >= 0),
    payment_method  VARCHAR2(20)
        CHECK (payment_method IN ('CASH','CARD','MOMO','BANK')),
    description     VARCHAR2(200),
    CONSTRAINT fk_purchases_customer
        FOREIGN KEY (customer_id)
        REFERENCES customers(customer_id)
        ON DELETE CASCADE
);

ðŸ”¹ POINT_RULES
CREATE TABLE point_rules (
    rule_id           NUMBER(5) PRIMARY KEY,
    rule_name         VARCHAR2(50) UNIQUE NOT NULL,
    amount_threshold  NUMBER(10,2) CHECK (amount_threshold >= 0),
    points_per_unit   NUMBER(5,2) CHECK (points_per_unit >= 0),
    effective_date    DATE NOT NULL,
    expiry_date       DATE
);

ðŸ”¹ REWARDS
CREATE TABLE rewards (
    reward_id         NUMBER(10) PRIMARY KEY,
    customer_id       NUMBER(10) NOT NULL,
    purchase_id       NUMBER(10),
    points_earned     NUMBER(10) DEFAULT 0 CHECK (points_earned >= 0),
    points_redeemed   NUMBER(10) DEFAULT 0 CHECK (points_redeemed >= 0),
    transaction_date  TIMESTAMP DEFAULT SYSTIMESTAMP,
    transaction_type  VARCHAR2(10)
        CHECK (transaction_type IN ('EARN','REDEEM','ADJUST')),
    CONSTRAINT fk_rewards_customer
        FOREIGN KEY (customer_id)
        REFERENCES customers(customer_id)
        ON DELETE CASCADE,
    CONSTRAINT fk_rewards_purchase
        FOREIGN KEY (purchase_id)
        REFERENCES purchases(purchase_id)
        ON DELETE SET NULL
);

ðŸ”¹ TRANSACTIONS_LOG
CREATE TABLE transactions_log (
    log_id          NUMBER(10) PRIMARY KEY,
    table_name      VARCHAR2(50) NOT NULL,
    operation_type  VARCHAR2(10)
        CHECK (operation_type IN ('INSERT','UPDATE','DELETE')),
    record_id       NUMBER(10) NOT NULL,
    user_name       VARCHAR2(50) DEFAULT USER,
    log_timestamp   TIMESTAMP DEFAULT SYSTIMESTAMP,
    old_value       CLOB,
    new_value       CLOB
);
